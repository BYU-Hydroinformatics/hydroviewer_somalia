{% extends "hydroviewer_somalia/base.html" %}

{% load staticfiles %}
{% load tethys_gizmos %}

{% block import_gizmos %}
    {% import_gizmo_dependency plotly_view %}
{% endblock %}

{% block app_content %}
  <div id="map" class="map"></div>
{% endblock %}

{% block header_buttons %}
  <div class="header-button glyphicon-button" data-toggle="tooltip" data-placement="bottom" title="View Graph">
    <a data-toggle="modal" data-target="#obsgraph"><span class="glyphicon glyphicon-globe"></span></a>
  </div>

  <div class="header-button glyphicon-button" data-toggle="tooltip" data-placement="bottom" title="Help">
    <a data-toggle="modal" data-target="#help-modal"><span class="glyphicon glyphicon-question-sign"></span></a>
  </div>
{% endblock %}

{# Use the after_app_content block for modals #}
{% block after_app_content %}
  <!----Observed Data ----->
  <div class="modal fade" id="obsgraph" tabindex="-1" role="dialog" aria-labelledby="about-modal-label">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
          <div class="row">
            <div id="station-info" class="col-md-8"></div>
            <div class="col-md-4">
              <div align="right">
                <img class="obslogos" src="{% static 'hydroviewer_somalia/images/byu_logo.png' %}">
                <img class="obslogos" src="{% static 'hydroviewer_somalia/images/my-icon.png' %}">
              </div>
            </div>
            <div id="interaction"></div>
          </div>
        </div>
        <div class="modal-body">
          <!-- Nav tabs -->
          <ul class="nav nav-tabs" role="tablist">
            <li role="presentation" class="active"><a id="observedQ_tab_link" href="#observedQ" aria-controls="observedQ" role="tab" data-toggle="tab">Observed Discharge</a></li>
            <li role="presentation"><a id="simulatedQ_tab_link" href="#simulatedQ" aria-controls="simulatedQ" role="tab" data-toggle="tab">Simulated Discharge</a></li>
            <li role="presentation"><a id="hydrographs_tab_link" href="#hydrographs" aria-controls="hydrographs" role="tab" data-toggle="tab">Hydrographs</a></li>
            <li role="presentation"><a id="dailyAverages_tab_link" href="#dailyAverages" aria-controls="dailyAverages" role="tab" data-toggle="tab">Daily Averages</a></li>
            <li role="presentation"><a id="monthlyAverages_tab_link" href="#monthlyAverages" aria-controls="monthlyAverages" role="tab" data-toggle="tab">Monthly Averages</a></li>
            <li role="presentation"><a id="scatterPlot_tab_link" href="#scatterPlot" aria-controls="scatterPlot" role="tab" data-toggle="tab">Scatter Plot</a></li>
            <li role="presentation"><a id="scatterPlotLogScale_tab_link" href="#scatterPlotLogScale" aria-controls="scatterPlotLogScale" role="tab" data-toggle="tab">Scatter Plot Log Scale</a></li>
            <li role="presentation"><a id="volumeAnalysis_tab_link" href="#volumeAnalysis" aria-controls="volumeAnalysis" role="tab" data-toggle="tab">Volume Analysis</a></li>
            <li role="presentation"><a id="metricsReport_tab_link" href="#metricsReport" aria-controls="metricsReport" role="tab" data-toggle="tab">Metrics Report</a></li>
            <li role="presentation"><a href="#download_data" aria-controls="download_data" role="tab" data-toggle="tab">Download Data</a></li>
          </ul>
          <!-- Tab panes -->
          <div class="tab-content">
            <div role="tabpanel" class="tab-pane active" id="observedQ">
              <div class="panel panel-default">
                <div class="panel-body">
                  <div class="flex-container-row"><img id="observed-loading-Q" class="view-file hidden" src="{% static 'hydroviewer_somalia/images/loader.gif' %}" /></div>
                  <div id="observed-chart-Q"></div>
                </div>
              </div>
            </div>
            <div role="tabpanel" class="tab-pane" id="simulatedQ">
              <div class="panel panel-default">
                <div class="panel-body">
                  <div class="flex-container-row"><img id="simulated-loading-Q" class="view-file hidden" src="{% static 'hydroviewer_somalia/images/loader.gif' %}" /></div>
                  <div id="simulated-chart-Q"></div>
                </div>
              </div>
            </div>
            <div role="tabpanel" class="tab-pane" id="hydrographs">
              <div class="panel panel-default">
                <div class="panel-body">
                  <div class="flex-container-row"><img id="hydrographs-loading" class="view-file hidden" src="{% static 'hydroviewer_somalia/images/loader.gif' %}" /></div>
                  <div id="hydrographs-chart"></div>
                </div>
              </div>
            </div>
            <div role="tabpanel" class="tab-pane" id="dailyAverages">
              <div class="panel panel-default">
                <div class="panel-body">
                  <div class="flex-container-row"><img id="dailyAverages-loading" class="view-file hidden" src="{% static 'hydroviewer_somalia/images/loader.gif' %}" /></div>
                  <div id="dailyAverages-chart"></div>
                </div>
              </div>
            </div>
            <div role="tabpanel" class="tab-pane" id="monthlyAverages">
              <div class="panel panel-default">
                <div class="panel-body">
                  <div class="flex-container-row"><img id="monthlyAverages-loading" class="view-file hidden" src="{% static 'hydroviewer_somalia/images/loader.gif' %}" /></div>
                  <div id="monthlyAverages-chart"></div>
                </div>
              </div>
            </div>
            <div role="tabpanel" class="tab-pane" id="scatterPlot">
              <div class="panel panel-default">
                <div class="panel-body">
                  <div class="flex-container-row"><img id="scatterPlot-loading" class="view-file hidden" src="{% static 'hydroviewer_somalia/images/loader.gif' %}" /></div>
                  <div id="scatterPlot-chart"></div>
                </div>
              </div>
            </div>
            <div role="tabpanel" class="tab-pane" id="scatterPlotLogScale">
              <div class="panel panel-default">
                <div class="panel-body">
                  <div class="flex-container-row"><img id="scatterPlotLogScale-loading" class="view-file hidden" src="{% static 'hydroviewer_somalia/images/loader.gif' %}" /></div>
                  <div id="scatterPlotLogScale-chart"></div>
                </div>
              </div>
            </div>
            <div role="tabpanel" class="tab-pane" id="volumeAnalysis">
              <div class="panel panel-default">
                <div class="panel-body">
                  <br>
                  <div class="metric-table" id="volume_table_div" style="display:none">
                    <div id="volume_table"><!-- The table or errors go here --></div>
                  </div>
                  <div class="flex-container-row"><img id="volumeAnalysis-loading" class="view-file hidden" src="{% static 'hydroviewer_somalia/images/loader.gif' %}" /></div>
                  <div id="volumeAnalysis-chart"></div>
                </div>
              </div>
            </div>
            <div role="tabpanel" class="tab-pane" id="metricsReport">
              <div class="panel panel-default">
                <div class="panel-body">
                  <hr>
                  <h2>Table</h2>
                  <hr>

                  <h3>Select the Metrics to Include in the Report:</h3>
                  <a href="https://hydroerr.readthedocs.io/en/stable/list_of_metrics.html" target="_blank">[Docs]</a>
                  <div id="metric_select_error"></div>
                  {# Displaying all of the metrics for the user to select #}
                  <select id="metric_select2" name="metrics" style="width: 100%" multiple="multiple">
                    {% for name_abbr in metric_loop_list %}
                      <option value="{{ name_abbr.1 }}">{{ name_abbr.0 }}</option>
                    {% endfor %}
                  </select>
                  <br>
                  <h4>
                    Optional Parameters
                    <span style="font-size: 15px;" class="glyphicon glyphicon-info-sign icon_info"
                          title="Optional parameter input boxes will appear here if a metric with optional parameters is selected.">
                    </span>
                  </h4>
                  <div class="form-row" id="mase_param_div" style="display: none">
                    <div class="form-group col-md-12" id="MASE_form">
                      <label for="mase_m">Mean Absolute Squared M Value</label>
                      <input type="number" class="form-control" id="mase_m" name="mase_m" value=1>
                    </div>
                  </div>
                  <div class="form-row" id="dmod_param_div" style="display: none">
                    <div class="form-group col-md-12" id="d_mod_form">
                      <label for="dmod_j">Modified Index of Agreement J Value</label>
                      <input type="number" class="form-control" id="dmod_j" name="dmod_j" value=1>
                    </div>
                  </div>
                  <div class="form-row" id="nse_mod_param_div" style="display: none">
                    <div class="form-group col-md-12" id="NSE_mod_form">
                      <label for="nse_mod_j">Modified Nash Sutcliffe J Value</label>
                      <input type="number" class="form-control" id="nse_mod_j" name="nse_mod_j" value=1>
                    </div>
                  </div>
                  <div class="form-row" id="lm_eff_param_div" style="display: none">
                    <div class="form-group col-md-12" id="lm_eff_form">
                      <label for="lm_x_bar">Legate-McCabe Efficiency x-bar Value</label>
                      <input type="number" class="form-control" id="lm_x_bar" name="lm_x_bar" value=1>
                    </div>
                  </div>
                  <div class="form-row" id="mean_h6_param_div" style="display: none">
                    <div class="form-group col-md-12" id="mean_H6_form">
                      <label for="h6_k_MHE">Mean H6 Error K Value</label>
                      <input type="number" class="form-control" id="h6_k_MHE" name="h6_k_MHE" value=1>
                    </div>
                  </div>
                  <div class="form-row" id="mean_abs_H6_param_div" style="display: none">
                    <div class="form-group col-md-12" id="mean_abs_H6_form">
                      <label for="h6_k_AHE">Mean Absolute H6 Error K Value</label>
                      <input type="number" class="form-control" id="h6_k_AHE" name="h6_k_AHE" value=1>
                    </div>
                  </div>
                   <div class="form-row" id="rms_H6_param_div" style="display: none">
                     <div class="form-group col-md-12" id="rms_H6_form">
                       <label for="h6_k_RMSHE">Root Mean Square H6 Error K Value</label>
                       <input type="number" class="form-control" id="h6_k_RMSHE" name="h6_k_RMSHE" value=1>
                     </div>
                   </div>
                  <div class="form-row" id="d1_p_param_div" style="display: none">
                    <div class="form-group col-md-12" id="d1_p_form">
                      <label for="d1_p_x_bar">Legate-McCabe Index of Agreement x-bar Value</label>
                      <input type="number" class="form-control" id="d1_p_x_bar" name="d1_p_x_bar" value=1>
                    </div>
                  </div>
                  <br><br>
                  <button type="button" class="btn btn-success" id="make-table">Make Report</button><br><br>
                  <div class="metric-table" id="metric-table" style="display:none">
                    <div id="table">{# The table of errors go here #}</div>
                  </div>
                </div>
              </div>
            </div>
            <div role="tabpanel" class="tab-pane" id="download_data">
              <div class="panel-body">
                <h6>Download Observed Discharge Data</h6>
                <div id="download_observed_discharge" class="btn-group hidden long-term-select" role="group">
                  <a class="btn btn-success" role="button" id="submit-download-observed-discharge">
                    <span class="glyphicon glyphicon-play"></span> Download Observed Discharge
                  </a>
                </div>
                <h6>Download Simulated Discharge Data</h6>
                <div id="download_simulated_discharge" class="btn-group hidden" role="group">
                  <a class="btn btn-info" role="button" id="submit-download-simulated-discharge">
                    <span class="glyphicon glyphicon-play"></span> Download Simulated Discharge
                  </a>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div id="info" class="hidden"></div>
        <div class="modal-footer">
          <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>
  <!-- About Modal -->
  <div class="modal fade" id="help-modal" tabindex="-1" role="dialog" aria-labelledby="help-modal-label">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
          <h5 class="modal-title" id="help-modal-label">Historical Validation Tool</h5>
        </div>
        <div class="modal-body">
          <p>The Historical Validation Tool customized for Colombia is a light-weight application for evaluating the historical simulation of Streamflow Prediction Too in Colombia.</p>
          <p>This app allows us to use the hydrostats functionality in order to evaluate how accurate is the historical simulation in Streamflow Prediction Tool compared to the observed streamflow in 412 Gauging Stations in Colombia.</p>
          <p>Users can click on any station in the map to retrieve observed and simulated data.</p>
          <ol>
            <li> The first tab displays a plot of the historical observed data.</li>
            <li> The second tab displays historic simulation data for 35 years from 1980 to 2015.</li>
            <li> The third tab corresponds to the merged hydrographs for observed and simulated data.</li>
            <li> The fourth tab displays the daily average streamflow for the historical observed and simulated data.</li>
            <li> The fifth tab displays the monthly average streamflow for the historical observed and simulated data.</li>
            <li> The sixth tab displays the scatter plot.</li>
            <li> The seventh tab displays the scatter plot in the log scale.</li>
            <li> The eighth tab correspond to the volume analysis and displays a table with the total simulated and observed volume and a plot with the cumulative simulated and observed volume.</li>
            <li> The nineth tab allows you select a set of metrics that you want to use in order to validate the historical simulation of the Streamflow Prediction Tool.</li>
            <li> The tenth tab allows you download the observed and the simulated data.</li>
            </ol>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
          <button type="button" class="btn btn-primary" data-dismiss="modal">OK</button>
        </div>
      </div>
    </div>
  </div>
{% endblock %}

{% block app_actions %}
{% endblock %}